<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblical Heralds - Ancient Voices, Living Word</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --background: #fafbfc;
            --text-primary: #333;
            --text-secondary: #2c3e50;
            --card-bg: white;
            --card-border: #e1e8ed;
            --accent-color: #667eea;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-hover: 0 8px 15px rgba(0, 0, 0, 0.12);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .header {
            background: var(--primary-gradient);
            color: white;
            padding: 2rem 0;
            text-align: center;
        }

        .header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .tagline { font-size: 1.2rem; opacity: 0.9; font-style: italic; }

        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }

        .intro {
            text-align: center;
            margin-bottom: 2rem;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .search-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .search-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .heralds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .herald-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .herald-card:hover { border-color: var(--accent-color); }
        .herald-card.selected { border-color: var(--accent-color); background: #f0f4ff; }

        .ask-button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 1.5rem 3rem;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 1rem;
        }

        .ask-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .response-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-top: 2rem;
            display: none;
        }

        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .heralds-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>Biblical Heralds</h1>
        <p class="tagline">Ancient Voices, Living Word</p>
    </header>

    <div class="container">
        <div class="intro">
            <p>A herald is a messenger who brings important news. Our Biblical Heralds reflect the Truth of Scripture through the lens of authentic personalities, shaped by what we know of these remarkable figures from the Old and New Testaments. <strong>Start by entering your question below</strong>, then choose a herald for their unique reflection. Each offers their distinct perspective and emphasisâ€”from John's love-focused insights to Deborah's strategic wisdom.</p>
        </div>

        <div class="search-section">
            <h2>What would you like to explore?</h2>
            <input type="text" id="searchInput" class="search-input" placeholder="Try: John 3:16, love, yeshua, or How do I find peace?">
            
            <div class="heralds-grid">
                <div class="herald-card" data-herald="john">
                    <h3>John</h3>
                    <p>The Beloved Disciple</p>
                    <small>Love-focused insights</small>
                </div>
                <div class="herald-card" data-herald="peter">
                    <h3>Peter</h3>
                    <p>The Bold Fisherman</p>
                    <small>Action-oriented wisdom</small>
                </div>
                <div class="herald-card" data-herald="barnabas">
                    <h3>Barnabas</h3>
                    <p>Son of Encouragement</p>
                    <small>Hope-building perspective</small>
                </div>
                <div class="herald-card" data-herald="mary">
                    <h3>Mary</h3>
                    <p>The Contemplative Learner</p>
                    <small>Thoughtful reflection</small>
                </div>
                <div class="herald-card" data-herald="deborah">
                    <h3>Deborah</h3>
                    <p>Judge and Prophetess</p>
                    <small>Strategic wisdom</small>
                </div>
            </div>

            <button id="askButton" class="ask-button" disabled>
                Select a question and herald above
            </button>
        </div>

        <div id="responseSection" class="response-section">
            <!-- Response will appear here -->
        </div>
    </div>

    <script>
        let selectedHerald = null;
        let isLoading = false;

        // Simple, guaranteed working JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const askButton = document.getElementById('askButton');
            const responseSection = document.getElementById('responseSection');
            const heraldCards = document.querySelectorAll('.herald-card');

            // Herald selection
            heraldCards.forEach(card => {
                card.addEventListener('click', function() {
                    heraldCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedHerald = this.dataset.herald;
                    updateButton();
                });
            });

            // Input monitoring
            searchInput.addEventListener('input', updateButton);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !askButton.disabled) {
                    askHerald();
                }
            });

            // Ask button
            askButton.addEventListener('click', askHerald);

            function updateButton() {
                const hasInput = searchInput.value.trim().length > 0;
                
                if (hasInput && selectedHerald) {
                    askButton.disabled = false;
                    askButton.textContent = `Ask ${selectedHerald.charAt(0).toUpperCase() + selectedHerald.slice(1)}`;
                } else if (hasInput) {
                    askButton.disabled = true;
                    askButton.textContent = 'Select a herald above';
                } else if (selectedHerald) {
                    askButton.disabled = true;
                    askButton.textContent = 'Enter your question above';
                } else {
                    askButton.disabled = true;
                    askButton.textContent = 'Enter question and select herald';
                }
            }

            async function askHerald() {
                if (isLoading || !selectedHerald || !searchInput.value.trim()) return;

                isLoading = true;
                askButton.disabled = true;
                askButton.textContent = 'Seeking wisdom...';
                
                responseSection.style.display = 'block';
                responseSection.innerHTML = '<p>The herald is contemplating your query...</p>';
                responseSection.scrollIntoView({ behavior: 'smooth' });

                try {
                    const response = await fetch('/api/heralds', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            herald: selectedHerald,
                            input: searchInput.value.trim(),
                            userId: 'user_' + Date.now()
                        })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        let html = `<h3>${data.heraldName || selectedHerald}</h3>`;
                        
                        if (data.verseText) {
                            html += `<div style="background: #f0f4ff; padding: 1rem; margin: 1rem 0; border-left: 4px solid var(--accent-color);">
                                <em>"${data.verseText.text}"</em><br>
                                <strong>${data.verseText.reference}</strong>
                            </div>`;
                        }
                        
                        html += `<div style="line-height: 1.7;">${data.response}</div>`;
                        responseSection.innerHTML = html;
                    } else {
                        responseSection.innerHTML = '<p>Sorry, there was an error. Please try again.</p>';
                    }
                } catch (error) {
                    responseSection.innerHTML = '<p>Unable to connect. Please check your connection and try again.</p>';
                } finally {
                    isLoading = false;
                    updateButton();
                }
            }
        });
    </script>
</body>
</html>
